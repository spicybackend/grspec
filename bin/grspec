#!/usr/bin/env ruby

require 'find_changed_files'
require 'find_matching_specs'
require 'spec_runner'

def display_listing(header, listing)
  puts
  puts header
  puts listing
end

git_diff_args = ARGV.join(' ')
changed_files = FindChangedFiles.new(ARGV).call

if changed_files.any?
  display_listing('Changed files:', changed_files)

  matching_specs = FindMatchingSpecs.new(changed_files).call

  if matching_specs.any?
    display_listing('Matching specs:', matching_specs)

    SpecRunner.run(matching_specs)
  else
    puts "No matching specs found"
  end
else
  puts "No changed files found"
end
