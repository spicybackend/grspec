#!/usr/bin/env ruby

require 'find_changed_files'
require 'find_matching_specs'
require 'spec_runner'

# handle args
git_diff_args = ARGV.join(' ')

# get changed files
changed_files = FindChangedFiles.new(ARGV).call

if !changed_files.any?
  puts "No changed files found"
  exit
end

# match specs
matching_specs = FindMatchingSpecs.new(changed_files).call

# debug info
puts
puts "Changed files:"
puts changed_files
puts
puts "Matching specs:"
puts matching_specs
puts

# run specs
SpecRunner.run(matching_specs)
