#!/usr/bin/env ruby
require 'active_support/core_ext/array/access'

require 'find_changed_files'
require 'find_matching_specs'
require 'spec_runner'

def display_listing(header, listing)
  puts
  puts header
  puts listing
end

git_diff_args = ARGV.first(2)

changed_files = FindChangedFiles.new(
  base_ref: git_diff_args.first,
  diff_ref: git_diff_args.second
).call

if changed_files.any?
  display_listing('Changed files:', changed_files)

  matching_specs = FindMatchingSpecs.new(changed_files).call

  if matching_specs.any?
    display_listing('Matching specs:', matching_specs)

    SpecRunner.run(matching_specs)
  else
    puts "No matching specs found"
  end
else
  puts "No changed files found"
end
